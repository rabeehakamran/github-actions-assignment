name: Weekly Maintenance Workflow

on:
  schedule:
    # Runs every Sunday at 7 AM UTC (12 PM Pakistan Time)
    - cron: "0 7 * * 0"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  maintenance:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Create maintenance log
        run: |
          mkdir -p logs
          echo "Maintenance ran at $(date)" > logs/maintenance_log.txt
          echo "â¬‡ Starting system checks..." >> logs/maintenance_log.txt

      - name: Check for outdated dependencies (non-blocking)
        run: |
          echo "Checking outdated dependencies ..." >> logs/maintenance_log.txt
          npm install > /dev/null 2>&1
          if ! npm outdated >> logs/maintenance_log.txt 2>&1; then
            echo "Dependency check completed (no failures)." >> logs/maintenance_log.txt
          fi

      - name: Backup logs
        run: |
          mkdir -p backups
          cp logs/maintenance_log.txt backups/backup_$(date +'%Y%m%d_%H%M').txt
          echo "ðŸ—‚ Backup created successfully!" >> logs/maintenance_log.txt

      - name: Commit & Push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add logs backups || true
          git commit -m "Weekly maintenance automation $(date)" || echo "No changes to commit"
          git push || echo "No changes to push"
